<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native Scope</title>
</head>

<body>
    <h5>Native Scope</h5>
    <div style="margin-bottom: 20px;">
        <div>
            <span style="color: green;">Native 接收到消息(Webview):</span>
            <span id="webview-message"></span>
        </div>
        <button id="button-webview">向 Webview 发送消息</button>
    </div>
    <iframe id="webview" src="./iframe.html"></iframe>

    <div>
        <span style="color: green;">Native 接收到消息(WebWorker):</span>
        <span id="webworker-message"></span>
    </div>
    <button id="button-webworker">向 WebWorker 发送消息</button>

    <script type="text/javascript">
        const webview = document.getElementById("webview");
        // 向 Webview（用 iframe 模拟）注入 JSBridge 对象
        webview.contentWindow.JSBridge = {
            onReceiveWebviewMessage: (msg) => {
                console.log(`Native 接收到消息: ${msg}`);
                document.getElementById("webview-message").innerText = msg;
            }
        }

        let indexA = 1;
        const buttonWebview = document.getElementById("button-webview");
        buttonWebview.addEventListener('click', () => {
            // 执行 Webview 暴露出来的方法
            webview.contentWindow.JSBridge.onReceiveNativeMessage(`这是来自 Native 的消息${indexA}`);
            indexA++;
        })
    </script>
    <script type="text/javascript">
        const jscore = new Worker('./core.js');
        const buttonWebworker = document.getElementById('button-webworker');
        let indexB = 1;
        buttonWebworker.addEventListener('click', () => {
            // 从 WebWorker 发送消息
            jscore.postMessage(`这是来自 Native 的消息${indexB}`);
            indexB++;
        });
        // 向 WebWorker 发送消息
        jscore.addEventListener('message', (e) => {
            console.log('Native 接收到消息:', e.data);
            document.getElementById("webworker-message").innerText = e.data;
        });
    </script>
</body>

</html>